name: ğŸ›¡ï¸ (Snyk Security Audit)

on:
  workflow_run:
    workflows: ["ğŸ›¡ï¸ (Code Health Check - Main)", "(Code Health Check - QA)"]
    types:
      - completed

jobs:
  snyk_check:
    name: ğŸ›¡ï¸ Snyk Security Audit
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ” Checkout repository
        uses: actions/checkout@v3

      - name: ğŸ” Run Snyk to check vulnerabilities
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          command: test

      - name: ğŸš¨ Post Snyk Security Failure
        if: failure()
        uses: mshick/add-pr-comment@v1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          repo-token-user-login: 'github-actions[bot]'
          message: |
            ## âŒ Snyk Security Audit Failed!
            ğŸš¨ Snyk found vulnerabilities in the code.
            
            Please review the results and address the issues immediately.

      - name: ğŸŸ¢ Snyk Security Audit Passed!
        if: success()
        uses: mshick/add-pr-comment@v1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          repo-token-user-login: 'github-actions[bot]'
          message: |
            ## ğŸ‰ Snyk Security Audit Passed!
            âœ… No vulnerabilities were found in the Snyk security audit.
