name: 🛡️ (Snyk Security Audit)

on:
  workflow_run:
    workflows: ["🛡️ (Code Health Check - Main)", "(Code Health Check - QA)"]
    types:
      - completed

jobs:
  snyk_check:
    name: 🛡️ Snyk Security Audit
    runs-on: ubuntu-latest
    steps:
      - name: 🔎 Checkout repository
        uses: actions/checkout@v3

      - name: 🔐 Run Snyk to check vulnerabilities
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          command: test

      - name: 🚨 Post Snyk Security Failure
        if: failure()
        uses: mshick/add-pr-comment@v1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          repo-token-user-login: 'github-actions[bot]'
          message: |
            ## ❌ Snyk Security Audit Failed!
            🚨 Snyk found vulnerabilities in the code.
            
            Please review the results and address the issues immediately.

      - name: 🟢 Snyk Security Audit Passed!
        if: success()
        uses: mshick/add-pr-comment@v1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          repo-token-user-login: 'github-actions[bot]'
          message: |
            ## 🎉 Snyk Security Audit Passed!
            ✅ No vulnerabilities were found in the Snyk security audit.
